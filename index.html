<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sơ đồ chỗ ngồi - Đặt chỗ</title>
  <style>
    /* Theme giống ảnh: nền tối, màu xanh lá cho trống, vàng cho đang đặt, xám cho đã đặt */
    :root{
      --bg:#0b0b0d;
      --panel:#111214;
      --muted:#a6a6aa;
      --accent-green:#2ed573;
      --accent-yellow:#f5b942;
      --sold:#3b3b3e;
      --card:#161618;
      --radius:12px;
    }
    html,body{height:100%;margin:0;font-family:Inter, Roboto, "Helvetica Neue", Arial,sans-serif;background:var(--bg);color:#fff}
    .container{max-width:1100px;margin:24px auto;padding:20px}
    h1{font-size:28px;margin:6px 0 18px}
    .top-row{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .legend{display:flex;gap:12px;align-items:center;background:linear-gradient(180deg,#101012,#0c0c0d);padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .legend .item{display:flex;gap:8px;align-items:center;font-size:14px;color:var(--muted)}
    .swatch{width:18px;height:18px;border-radius:6px;border:2px solid rgba(255,255,255,0.06);display:inline-block}
    .swatch.empty{background:transparent;border-color:var(--accent-green);box-shadow:0 0 0 2px rgba(46,213,115,0.06)}
    .swatch.selected{background:var(--accent-yellow)}
    .swatch.booked{background:var(--sold)}
    /* Seat area */
    .seat-area{margin-top:22px;background:linear-gradient(180deg,#0f0f11,#0b0b0d);padding:28px;border-radius:16px;border:1px solid rgba(255,255,255,0.03)}
    .screen-btn{display:block;margin:0 auto 18px auto;padding:12px 20px;text-align:center;border-radius:10px;background:#2b2b2e;color:#ddd;width:420px;max-width:90%;box-shadow:inset 0 -3px 0 rgba(0,0,0,0.4)}
    .seats-grid{display:grid;grid-template-columns:1fr 56px 1fr;gap:10px;align-items:start}
    .col{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;justify-items:center}
    .col-right{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;justify-items:center}
    /* seat button */
    .seat{
      width:56px;height:46px;border-radius:10px;border:2px solid rgba(255,255,255,0.06);
      background:#0f1113;color:#bfc3c7;display:grid;place-items:center;font-weight:600;cursor:pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.6), inset 0 -2px 0 rgba(255,255,255,0.02);
    }
    .seat.empty{background:transparent;border:none;cursor:default;width:12px;height:12px}
    .seat.available{border-color:rgba(46,213,115,0.15)}
    .seat.available:hover{transform:translateY(-4px)}
    .seat.free{border:2px solid rgba(46,213,115,0.9);color:var(--accent-green);background:transparent}
    .seat.selected{border:2px solid var(--accent-yellow);background:linear-gradient(180deg,#3b2b10,#2f250b);color:#111}
    .seat.sold{background:var(--sold);color:#6d6e71;border:2px solid rgba(255,255,255,0.03);cursor:not-allowed}
    /* left info pane & actions */
    .footer-bar{display:flex;align-items:center;justify-content:space-between;margin-top:18px;gap:12px}
    .info{display:flex;gap:12px;align-items:center}
    .pill{background:#0f1012;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);font-size:14px;color:var(--muted)}
    .actions{display:flex;gap:8px}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#ddd}
    .btn.primary{background:var(--accent-yellow);color:#111}
    /* Booking view (after select) */
    .booking-view{display:none;margin-top:20px;background:linear-gradient(180deg,#0e0e10,#0c0c0d);padding:24px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .booking-header{display:flex;align-items:center;gap:16px;justify-content:space-between}
    .back{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;cursor:pointer}
    .booking-card{margin-top:18px;padding:20px;border-radius:12px;background:linear-gradient(180deg,#121214,#0d0d0e);border:1px solid rgba(255,255,255,0.02)}
    .form-row{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    label{font-size:14px;color:var(--muted)}
    input[type=text], input[type=email], input[type=tel]{background:#0c0c0d;border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:8px;color:#fff}
    .qr-wrap{margin-top:14px;padding:16px;border-radius:10px;background:#0b0b0d;border:1px solid rgba(255,255,255,0.02)}
    .qr-img{width:100%;max-width:520px;height:320px;background:
      linear-gradient(90deg,#ddd 10%, #333 10%) ,
      linear-gradient(180deg,#ddd 10%, #333 10%);
      background-size:12px 12px;
      display:block;border-radius:8px;}
    .timer{font-weight:700;color:var(--muted)}
    /* responsive */
    @media (max-width:880px){
      .seats-grid{grid-template-columns:1fr;gap:14px}
      .col, .col-right{grid-template-columns:repeat(6,1fr)}
      .seat{width:46px;height:40px}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sơ đồ chỗ ngồi - Chiếu phim gây quỹ AAVC</h1>

    <div class="top-row">
      <div class="legend" role="list" aria-label="Chú thích trạng thái ghế">
        <div class="item"><span class="swatch empty" aria-hidden="true"></span> <span style="color:var(--muted)">Trống</span></div>
        <div class="item"><span class="swatch selected" aria-hidden="true"></span> <span style="color:var(--muted)">Đang đặt</span></div>
        <div class="item"><span class="swatch booked" aria-hidden="true"></span> <span style="color:var(--muted)">Đã đặt</span></div>
      </div>

      <div style="display:flex;gap:12px;align-items:center">
        <div class="pill">Cụm rạp màn hình</div>
        <div class="pill timer" id="main-timer">30:00</div>
      </div>
    </div>

    <!-- Seat selection area (ảnh 1) -->
    <section class="seat-area" id="seat-view" aria-label="Sơ đồ ghế">
      <div class="screen-btn" role="img" aria-label="màn hình">Cụm rạp màn hình</div>

      <div class="seats-grid" id="seats-grid" aria-hidden="false">
        <div class="col" id="left-col" aria-label="Bên trái ghế"></div>
        <div style="display:grid;place-items:center"><div style="width:44px;height:200px"></div></div>
        <div class="col-right" id="right-col" aria-label="Bên phải ghế"></div>
      </div>

      <div class="footer-bar">
        <div class="info">
          <div class="pill">Chọn: <strong id="chosen-count">0</strong> ghế</div>
          <div class="pill">Ghế: <span id="chosen-list">—</span></div>
        </div>

        <div class="actions">
          <button class="btn secondary" id="reset">Xóa chọn</button>
          <button class="btn primary" id="proceed" title="Chuyển sang trang đặt chỗ">Tiếp tục</button>
        </div>
      </div>
    </section>

    <!-- Booking view (ảnh 2) -->
    <section class="booking-view" id="booking-view" aria-label="Đặt chỗ">
      <div class="booking-header">
        <div style="display:flex;flex-direction:column">
          <div style="font-size:22px;font-weight:700">Đặt chỗ</div>
          <div style="color:var(--muted);margin-top:6px">Vị trí: <strong id="booking-seat">—</strong></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <div class="timer" id="booking-timer">29:59</div>
          <button class="back" id="back-to-seats" aria-label="Quay lại sơ đồ ghế">← Back</button>
        </div>
      </div>

      <div class="booking-card">
        <form id="booking-form" onsubmit="return false">
          <div class="form-row">
            <label for="name">Họ và tên</label>
            <input id="name" type="text" placeholder="Nguyễn Văn A" required />
          </div>
          <div class="form-row">
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="user@example.com" required />
          </div>
          <div class="form-row">
            <label for="phone">Số điện thoại</label>
            <input id="phone" type="tel" placeholder="0123456789" required />
          </div>

          <div style="margin-top:14px;font-weight:700">Hướng dẫn thanh toán</div>
          <div class="qr-wrap">
            <!-- Placeholder QR style: replace src with real QR in production -->
            <div class="qr-img" id="qr-image" role="img" aria-label="QR thanh toán"></div>
            <div style="margin-top:10px;color:var(--muted);font-size:13px">Chuyển khoản tới: <strong>TRAN PHUONG ANH</strong> — 0126163397102</div>
          </div>

          <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:18px">
            <button class="btn secondary" id="cancel-book">Hủy</button>
            <button class="btn primary" id="confirm-book">Xác nhận & Thanh toán</button>
          </div>
        </form>
      </div>
    </section>

  </div>

  <script>
    // Cấu hình chỗ: tạo hai cột, các hàng A..O, cột số 1..14 với một hành lang giữa (chia 7 và 7)
    const ROWS = "ABCDEFGHIJKLMNOPQRST".split('').slice(0,15); // A..O
    const COLS_PER_SIDE = 7; // 7 ghế mỗi bên per row (giống ảnh)
    const leftCol = document.getElementById('left-col');
    const rightCol = document.getElementById('right-col');
    const chosenCountEl = document.getElementById('chosen-count');
    const chosenListEl = document.getElementById('chosen-list');
    const proceedBtn = document.getElementById('proceed');
    const resetBtn = document.getElementById('reset');
    const seatView = document.getElementById('seat-view');
    const bookingView = document.getElementById('booking-view');
    const bookingSeatEl = document.getElementById('booking-seat');
    const backBtn = document.getElementById('back-to-seats');
    const mainTimerEl = document.getElementById('main-timer');
    const bookingTimerEl = document.getElementById('booking-timer');

    // Mẫu ghế đã đặt (sold)
    const soldSample = new Set([
      "A3","A4","B2","C7","D1","F5","G4","H2","I6","K3","L5","M1"
    ]);

    // Lưu selection giữa các view
    let selectedSeats = new Set();

    function seatId(row, idxSide, pos){
      // idxSide: 'L' or 'R', pos: 1..COLS_PER_SIDE
      return row + (idxSide === 'L' ? (COLS_PER_SIDE - pos + 1) : (COLS_PER_SIDE + pos));
    }

    function createSeatButton(id, state){
      const btn = document.createElement('button');
      btn.className = 'seat';
      btn.type = 'button';
      btn.textContent = id;
      btn.dataset.seat = id;
      if(state === 'sold'){
        btn.classList.add('sold');
        btn.setAttribute('aria-label', id + ': đã đặt');
        btn.disabled = true;
      } else {
        btn.classList.add('available');
        btn.setAttribute('aria-label', id + ': trống');
        btn.addEventListener('click', onSeatClick);
      }
      return btn;
    }

    // Tạo layout giống ảnh: mỗi hàng xuất hiện 7 ghế bên trái và 7 ghế bên phải (đứng theo mẫu A14..A1 left and A1..A13 right)
    function renderSeats(){
      leftCol.innerHTML = '';
      rightCol.innerHTML = '';
      ROWS.forEach(row => {
        // create left side (positions 7..1 so they visually match numbering on left)
        for(let p=1;p<=COLS_PER_SIDE;p++){
          // map to seat id like E14, E12, ... to simulate numbering in image: here we generate consistent ids
          const id = row + String(p + COLS_PER_SIDE); // use numbers 8..14 for right mapping cause we need distinct ids across both sides
          // To mimic image numbering (e.g., A14..A2 left and A1..A13 right) we choose a pattern:
          // Left side: seats with higher numbers (8..14), Right side: 1..7 (but we show right as 1..7)
          const leftId = row + String((COLS_PER_SIDE*2) - p + 1); // e.g., 14..8
          const rightId = row + String(p); // 1..7
          // Left side seat
          const leftBtn = soldSample.has(leftId) ? createSeatButton(leftId,'sold') : createSeatButton(leftId,'free');
          // Right side seat
          const rightBtn = soldSample.has(rightId) ? createSeatButton(rightId,'sold') : createSeatButton(rightId,'free');

          // For layout, wrap each seat in a small container to keep grid consistent
          const leftWrap = document.createElement('div'); leftWrap.appendChild(leftBtn);
          const rightWrap = document.createElement('div'); rightWrap.appendChild(rightBtn);

          leftCol.appendChild(leftWrap);
          rightCol.appendChild(rightWrap);
        }
      });
      // re-apply selected if any
      selectedSeats.forEach(s=>{
        const btn = document.querySelector(`.seat[data-seat="${s}"]`);
        if(btn && !btn.classList.contains('sold')){
          btn.classList.add('selected');
        }
      });
      updateSummary();
    }

    function onSeatClick(e){
      const btn = e.currentTarget;
      const id = btn.dataset.seat;
      if(btn.classList.contains('selected')){
        btn.classList.remove('selected');
        selectedSeats.delete(id);
      } else {
        // toggle on
        btn.classList.add('selected');
        selectedSeats.add(id);
      }
      updateSummary();
    }

    function updateSummary(){
      const arr = Array.from(selectedSeats).sort();
      chosenCountEl.textContent = arr.length;
      chosenListEl.textContent = arr.length ? arr.join(', ') : '—';
    }

    resetBtn.addEventListener('click', ()=>{
      selectedSeats.clear();
      document.querySelectorAll('.seat.selected').forEach(b=>b.classList.remove('selected'));
      updateSummary();
    });

    // Progress to booking view
    proceedBtn.addEventListener('click', ()=> {
      if(selectedSeats.size === 0){
        alert('Vui lòng chọn ít nhất 1 ghế trước khi tiếp tục.');
        return;
      }
      // show booking view and fill seat(s)
      const seatsArr = Array.from(selectedSeats).sort();
      bookingSeatEl.textContent = seatsArr.join(', ');
      seatView.style.display = 'none';
      bookingView.style.display = 'block';
      // start short booking timer (copy main timer)
      startBookingTimer(30*60); // 30 minutes in seconds
    });

    backBtn.addEventListener('click', ()=>{
      bookingView.style.display = 'none';
      seatView.style.display = 'block';
      // stop booking timer if any
      stopBookingTimer();
    });

    // Booking timer utilities
    let bookingTimerInterval = null;
    function startBookingTimer(seconds){
      stopBookingTimer();
      let remaining = seconds;
      function tick(){
        const mm = String(Math.floor(remaining/60)).padStart(2,'0');
        const ss = String(remaining%60).padStart(2,'0');
        bookingTimerEl.textContent = `${mm}:${ss}`;
        mainTimerEl.textContent = `${mm}:${ss}`;
        if(remaining <= 0){
          stopBookingTimer();
          alert('Hết thời gian giữ ghế. Vui lòng chọn lại.');
          // cancel booking and go back
          selectedSeats.clear();
          document.querySelectorAll('.seat.selected').forEach(b=>b.classList.remove('selected'));
          updateSummary();
          bookingView.style.display = 'none';
          seatView.style.display = 'block';
        }
        remaining--;
      }
      tick();
      bookingTimerInterval = setInterval(tick,1000);
    }
    function stopBookingTimer(){
      if(bookingTimerInterval) clearInterval(bookingTimerInterval);
      bookingTimerInterval = null;
    }

    // Small static main timer shown initially (30:00)
    (function startMainTimer(){
      let remaining = 30*60;
      function t(){
        const mm = String(Math.floor(remaining/60)).padStart(2,'0');
        const ss = String(remaining%60).padStart(2,'0');
        mainTimerEl.textContent = `${mm}:${ss}`;
        remaining--;
        if(remaining<0) remaining = 30*60; // loop for demo (not necessary in prod)
      }
      t();
      setInterval(t,1000);
    })();

    // Booking form (simulate confirm)
    document.getElementById('confirm-book').addEventListener('click', ()=>{
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      if(!name || !email || !phone){
        alert('Vui lòng điền đầy đủ thông tin liên hệ.');
        return;
      }
      // Simulate booking: mark seats as sold and show QR (or confirmation)
      Array.from(selectedSeats).forEach(s=>{
        const btn = document.querySelector(`.seat[data-seat="${s}"]`);
        if(btn){
          btn.classList.remove('selected');
          btn.classList.remove('available');
          btn.classList.add('sold');
          btn.disabled = true;
          btn.removeEventListener('click', onSeatClick);
        }
      });
      // clear selection
      selectedSeats.clear();
      updateSummary();
      alert('Đặt chỗ thành công. Vui lòng thanh toán theo thông tin QR hiển thị.');
      // For demo we keep booking view visible and show a simple QR pattern (already shown)
    });

    document.getElementById('cancel-book').addEventListener('click', (e)=>{
      e.preventDefault();
      // cancel -> back to seat view and keep selections unchanged
      bookingView.style.display = 'none';
      seatView.style.display = 'block';
      stopBookingTimer();
    });

    // Simple decorative QR generation (draw a checkerboard-ish pattern in canvas and set it as background)
    (function generateDecorativeQR(){
      const canvas = document.createElement('canvas');
      canvas.width = 520; canvas.height = 320;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#fff';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      // random-ish black squares to give QR feeling (for demo only)
      ctx.fillStyle = '#111';
      for(let x=0;x<26;x++){
        for(let y=0;y<16;y++){
          if(Math.random() > 0.7) ctx.fillRect(x*20 + (x%2?3:0), y*20 + (y%2?3:0), 16, 16);
        }
      }
      // add decorative top name box
      ctx.fillStyle = '#f5f5f7';
      ctx.fillRect(12,8,200,40);
      ctx.fillStyle = '#111';
      ctx.font = '16px sans-serif';
      ctx.fillText('TRAN PHUONG ANH', 20, 35);
      const dataUrl = canvas.toDataURL('image/png');
      const qr = document.getElementById('qr-image');
      qr.style.backgroundImage = `url(${dataUrl})`;
      qr.style.backgroundSize = 'cover';
    })();

    // init
    renderSeats();
  </script>
</body>
</html>
